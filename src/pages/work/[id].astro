---
import { getCollection, render } from "astro:content";
import { Image } from "astro:assets";
import Main from "@/layouts/Main.astro";

export async function getStaticPaths() {
  const works = await getCollection("work");
  return works.map((work) => ({
    params: { id: work.id },
    props: { work },
  }));
}

const { work } = Astro.props;

const { Content } = await render(work);

const {
  data: { title, description, tech, type, startDate, endDate, images },
  id,
} = work;

const start = startDate ? new Date(startDate) : null;
const end = endDate ? new Date(endDate) : null;
const dateRange =
  start && end
    ? `${start.getFullYear()} – ${end.getFullYear()}`
    : start
      ? start.getFullYear().toString()
      : null;
---

<Main
  page={{
    title: `${title} ・ work ・ alex-xo`,
    description: `${description}`,
    navActive: "work",
  }}
>
  <div class="max-w-360 m-auto px-6 py-16 flex flex-row gap-8">
    {/* Content Column */}
    <div class="w-1/3 sticky top-0">
      <div class="flex flex-col gap-8 p-8 bg-card shadow-card-work text-primary">
        <div class="w-full flex flex-col gap-1">
          <h1 class="font-black italic text-primary text-3xl">{title}</h1>
          {
            type && type?.length > 0 && (
              <p class="text-base italic text-primary">
                {type.join(", ")} ({dateRange})
              </p>
            )
          }
        </div>

        <div class="space-y-4 text-base text-primary">
          <Content />
        </div>

        {
          tech && tech?.length > 0 && (
            <p class="text-sm text-primary">
              Tech: <span class="font-medium">{tech.join(", ")}</span>
            </p>
          )
        }
      </div>
    </div>

    {/* Image Column */}
    <div class="w-2/3 flex flex-col gap-10">
      {
        images?.map((image) => (
          <div class="bg-work-card shadow-card-work block">
            <Image src={image} alt="" />
          </div>
        ))
      }
    </div>
  </div>
</Main>
